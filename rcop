#!/usr/bin/env bash

# Check if correct number of arguments are provided
if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <file_with_urls> <rclone_remote:path>"
    exit 1
fi

URL_FILE="$1"
REMOTE_DEST="$2"

# Check if the file exists
if [ ! -f "$URL_FILE" ]; then
    echo "Error: File '$URL_FILE' not found!"
    exit 1
fi

# Loop through each line in the file
while IFS= read -r URL; do
    # Skip empty lines
    if [[ -z "$URL" ]]; then
        continue
    fi
    
    echo "Copying $URL to $REMOTE_DEST"
    rclone copyurl "$URL" "$REMOTE_DEST" --auto-filename -vv
    
    # Check exit status of rclone command
    if [ $? -ne 0 ]; then
        echo "Failed to copy $URL"
    else
        echo "Successfully copied $URL"
    fi

done < "$URL_FILE"
