#!/usr/bin/env bash

# Check if at least one argument (the folder) is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <folder_path> [output_name]"
    exit 1
fi

FOLDER_PATH="${1%/}"  # Remove trailing slash if present
FOLDER_NAME=$(basename "$FOLDER_PATH")

# Determine the output filename
# If $2 is provided, use it; otherwise, use the folder name + .zip
OUTPUT_NAME="${2:-$FOLDER_NAME.zip}"

# Ensure the output ends with .zip if not already specified
if [[ ! "$OUTPUT_NAME" =~ \.zip$ ]]; then
    OUTPUT_NAME="$OUTPUT_NAME.zip"
fi

echo "Compressing '$FOLDER_PATH' into '$OUTPUT_NAME'..."

# Run 7zip
# -tzip: specifies zip format
# -r: recursive (though 7z handles directories well by default)
7z a -tzip -mx0 "$OUTPUT_NAME" "$FOLDER_PATH"

if [ $? -eq 0 ]; then
    echo "Successfully created $OUTPUT_NAME"
else
    echo "Error: Compression failed."
    exit 1
fi
